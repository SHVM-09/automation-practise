name: Release Laravel

on:
  push:
    tags:
      - "v*.*.*"

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      TEMPLATE_NAME: materio
      GitHubPersonalToken: ${{ secrets.GH_PAT }}
    steps:
      - name: Checkout template
        uses: actions/checkout@v3
        with:
          path: ${{ env.TEMPLATE_NAME }}/vue-laravel

      - name: Checkout vue version
        uses: actions/checkout@v3
        with:
          repository: themeselection/materio-vuetify-vuejs-admin-template
          token: ${{ secrets.GH_PAT }}
          path: ${{ env.TEMPLATE_NAME }}/vue

      - name: Checkout scripts
        uses: actions/checkout@v3
        with:
          repository: themeselection/automation-scripts
          token: ${{ secrets.GH_PAT }}
          path: automation-scripts
      
      - name: Install packages in automation-scripts dir
        working-directory: automation-scripts/vue
        run: yarn
        
      - name: Generate package
        working-directory: automation-scripts/vue
        run: yarn tsx src/templates/${{ env.TEMPLATE_NAME }}/scripts/genLaravel.ts --version ${{ github.ref_name }}

      - name: Release
        uses: softprops/action-gh-release@v1
        with:
          files: ${{ env.TEMPLATE_NAME }}/vue-laravel/*.zip
          body: Please refer to [CHANGELOG.md](https://github.com/${{ github.repository }}/blob/main/CHANGELOG.md) for details.
