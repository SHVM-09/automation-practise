name: Release
run-name: ‚ú® Release ${{ github.ref_name }}

on:
  push:
    tags:
      - "v*.*.*"

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      GitHubPersonalToken: ${{ secrets.GH_PAT }}
    steps:
      - name: ‚öôÔ∏è Set TEMPLATE_NAME environment variable from repo name
        run: echo TEMPLATE_NAME=${{ github.event.repository.name }} | cut -d '-' -f1 >> $GITHUB_ENV

      - name: ‚¨áÔ∏è Checkout template
        uses: actions/checkout@v3
        with:
          path: ${{ env.TEMPLATE_NAME }}/vue-laravel

      - name: ‚¨áÔ∏è Checkout vue version
        uses: actions/checkout@v3
        with:
          repository: themeselection/${{ env.TEMPLATE_NAME }}-vuetify-vuejs-admin-template
          token: ${{ secrets.GH_PAT }}
          path: ${{ env.TEMPLATE_NAME }}/vue

      - name: ‚¨áÔ∏è Checkout scripts
        uses: actions/checkout@v3
        with:
          repository: themeselection/automation-scripts
          token: ${{ secrets.GH_PAT }}
          path: automation-scripts
      
      - name: ‚¨áÔ∏è Install packages in automation-scripts dir
        working-directory: automation-scripts/vue
        run: yarn
        
      - name: üì¶ Generate package
        working-directory: automation-scripts/vue
        run: yarn tsx src/templates/${{ env.TEMPLATE_NAME }}/scripts/genLaravel.ts --version ${{ github.ref_name }}

      - name: üöÄ Release
        uses: softprops/action-gh-release@v1
        with:
          files: ${{ env.TEMPLATE_NAME }}/vue-laravel/*.zip
          body: Please refer to [CHANGELOG.md](https://github.com/${{ github.repository }}/blob/main/CHANGELOG.md) for details.
